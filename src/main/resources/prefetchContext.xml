<?xml version="1.0" encoding="UTF-8"?>
<beans 
	xmlns="http://www.springframework.org/schema/beans" 
	xmlns:task="http://www.springframework.org/schema/task"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    
    xsi:schemaLocation="
    	http://www.springframework.org/schema/beans 	http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
    	http://www.springframework.org/schema/context	http://www.springframework.org/schema/context/spring-context-3.1.xsd
		http://www.springframework.org/schema/task 		http://www.springframework.org/schema/task/spring-task-3.1.xsd
    ">
    
	<context:property-placeholder ignore-unresolvable="true"/>
		
	<bean id="Prefetcher" class="gov.usgs.ngwmn.dm.prefetch.Prefetcher" >
		<property name="fetchLimit" value="${ngwmn_prefetch_count_limit:400}"/>
		<property name="timeLimit" 	value="${ngwmn_prefetch_ms_limit:18000000}"/>
		<property name="wellDAO" 	ref="WellRegistryDAO"/>
		<property name="cacheDAO" 	ref="CacheMetaDataDAO"/>
		<property name="broker" 	ref="DataBroker"/>
		<property name="threadCount" value="-1"/>
	</bean>
    
    <bean id="PrefetchInstance" parent="Prefetcher" scope="prototype"/>
    
    <task:scheduled-tasks scheduler="scheduler">
    														<!--  second minute hour day month weekday -->
<!--     	<task:scheduled ref="Prefetcher" method="call" cron="0 21 ${ngwmn_prefetch_start_hour:22} * * ?"/> -->
    	<task:scheduled ref="PrefetchController" method="startInParallel" cron="0 40 ${ngwmn_prefetch_start_hour:22} * * ?"/>
    	<task:scheduled ref="PrefetchController" method="gatherWaterlevelRankStats" fixed-delay="120000"/>
    </task:scheduled-tasks>
    
    <task:scheduler id="scheduler" pool-size="12"/>
    
    <bean id="WaterlevelRankStatsWorker" class="gov.usgs.ngwmn.dm.prefetch.WaterlevelRankStatsWorker">
    	<property name="dataSource" ref="dataSource"/>
    </bean>
    
    <bean id="PrefetchController" class="gov.usgs.ngwmn.dm.prefetch.PrefetchController">
    	<property name="scheduler" ref="scheduler"/>
    	<property name="prefetcher" ref="Prefetcher"/>
    	<property name="cleaner" ref="CacheCleaner"/>
    	<property name="mbeanExporter" ref="mbeanExporter"/>
    	<property name="waterlevelRankStatsWorker" ref="WaterlevelRankStatsWorker"/>
    </bean>
    
<!--     
	<bean id="ShutdownController" class="gov.usgs.ngwmn.dm.prefetch.ShutdownController">
		<property name="scheduler" ref="scheduler"/>
    </bean> 
-->
   
</beans>